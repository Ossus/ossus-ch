/**
 *  Main script file.
 *//**
 *  Sets up our circus.
 */function setupCircus(){$("#circus-logo").attr("src",onRetinaScreen()?"images/Ossus-300@2x.png":"images/Ossus-300.png").hide();var e=$("#circus").find(".item"),t=360/e.length;e.each(function(e,t){var n=$(t),r=n.data("app"),i=r in _data?_data[r]:{},s="name"in i?i.name:r,o="url"in i?i.url:"",u=$("<a/>").attr("href",o),a=$("<img/>").attr("src","images/"+r+(onRetinaScreen()?"@2x":"")+".png").attr("alt",r),f=$("<span/>").text(s);u.append(a).append(f);n.append(u);u.click(function(e){e.stopPropagation();return!0});var l="desc"in i?i.desc:null;if(l){var c=$("<div/>").html("<h2>"+s+"</h2>"+l);c.click(function(e){e.stopPropagation();e.preventDefault()});n.append(c)}n.show();circlePutItemToPositionAtAngle(n,90)})}function toggleCircus(){var e=$("#circus");_circus_timeout&&window.clearTimeout(_circus_timeout);var t=e.find(".item"),n=360/t.length,r="",i=1e3,s=-110,o=!0;if(e.hasClass("shown")){n=0;r="40%";i=0;s=90;o=!1}t.each(function(t,r){circleItemTo($(r),s+t*n,e)});e.toggleClass("shown");var u=300/$(window).width()*100;$("#full").css("background-size",u+"%");_circus_timeout=window.setTimeout(function(){if(o){$("#full").css("background-size",r).css("background-image","none");$("#circus-logo").show()}else{$("#full").css("background-size",r).css("background-image","url(images/Ossus-1200.png)");$("#circus-logo").hide()}},i)}function onRetinaScreen(){return"devicePixelRatio"in window?window.devicePixelRatio>1.5:!1}function circleItemTo(e,t,n,r,i){var s=e.attr("id");if(!s){s="circle"+(new Date).getTime()+Math.round(Math.random()*1e5);e.attr("id",s)}var o=parseInt(e.css("left"))+e.outerWidth()/2,u=parseInt(e.css("top"))+e.outerHeight()/2,a=o-n.innerWidth()/2,f=u-n.innerHeight()/2,l=Math.atan2(f,a),c=Math.ceil(Math.sqrt(a*a+f*f));t%=360;t>180?t-=360:t<-180&&(t+=360);var h=deg2rad(t);while(h<l)h+=2*Math.PI;if(Math.round(l/.017453)==t)return!1;e.css("position","absolute");r=r?r:0;var p=(new Date).getTime(),d=i?i:_circleState.duration,v={view:e,width:e.width(),height:e.height(),box:{width:n.innerWidth(),height:n.innerHeight()},radius:c,start:{rad:l,time:p+r},end:{rad:h,time:p+r+d},duration:d,interval:null};_circleState.items[s]=v;_circleState.interval||(_circleState.interval=window.setInterval(_circleView,20));return!0}function _circleView(){var e=_circleState;if(!e)return;var t=(new Date).getTime(),n=0;for(var r in _circleState.items){var i=_circleState.items[r];if(i.start.time>t)continue;var s=0;n=Math.max(i.end.time,n);if(t<i.end.time){var o=(t-i.start.time)/i.duration,u=o;i.linear||(u=o*o*3-o*o*o*2);s=i.start.rad+u*(i.end.rad-i.start.rad)}else{s=i.end.rad;delete _circleState.items[r]}_circlePutItem(i.view,s,i.width,i.height,i.box)}if(n<t){window.clearInterval(_circleState.interval);_circleState.interval=null;_circleState.items={}}}function circlePutItemToPositionAtAngle(e,t){var n=e.offsetParent(),r={width:n.innerWidth(),height:n.innerHeight()};_circlePutItem(e,deg2rad(t),e.width(),e.height(),r)}function _circlePutItem(e,t,n,r,i){var s={x:i.width/2,y:i.height/2},o=Math.sin(t)*s.x,u=Math.cos(t)*s.x,a=s.x+u-n/2,f=s.y+o-r/2;i.width!=i.height;e.css("top",f).css("left",a)}function deg2rad(e){return e*.017453}var _circus_timeout=null,_circleState={items:[],interval:null,duration:1e3};